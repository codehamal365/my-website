<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-spring/spring-websocket" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">WebSocket 的 6 种集成方式 | 我的小站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://codehamal365.github.io/my-website/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://codehamal365.github.io/my-website/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://codehamal365.github.io/my-website/docs/spring/spring-websocket"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="WebSocket 的 6 种集成方式 | 我的小站"><meta data-rh="true" name="description" content="介绍"><meta data-rh="true" property="og:description" content="介绍"><link data-rh="true" rel="icon" href="/my-website/img/favicon copy.ico"><link data-rh="true" rel="canonical" href="https://codehamal365.github.io/my-website/docs/spring/spring-websocket"><link data-rh="true" rel="alternate" href="https://codehamal365.github.io/my-website/docs/spring/spring-websocket" hreflang="en"><link data-rh="true" rel="alternate" href="https://codehamal365.github.io/my-website/docs/spring/spring-websocket" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/my-website/blog/rss.xml" title="我的小站 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-website/blog/atom.xml" title="我的小站 Atom Feed"><link rel="stylesheet" href="/my-website/assets/css/styles.2d3f038e.css">
<script src="/my-website/assets/js/runtime~main.0affc6cd.js" defer="defer"></script>
<script src="/my-website/assets/js/main.fb32f52b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-website/"><div class="navbar__logo"><img src="/my-website/img/favicon copy.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/my-website/img/favicon copy.ico" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">我的小站</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/my-website/docs/框架学习">文档</a><a class="navbar__item navbar__link" href="/my-website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/codehamal365/my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/框架学习">框架学习</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/my-website/docs/category/工具">工具</a><button aria-label="Expand sidebar category &#x27;工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/my-website/docs/category/vue3">Vue3</a><button aria-label="Expand sidebar category &#x27;Vue3&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/my-website/docs/category/tint">Tint</a><button aria-label="Expand sidebar category &#x27;Tint&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/aem/">AEM</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-website/docs/azure/Azure-apim">azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-website/docs/git/git-commands">git</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-website/docs/mq/什么是消息队列">mq</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/my-website/docs/spring/@Value">spring</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/@Value">@Value</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/ConfigurationProperties解析">ConfigurationProperties解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/Spring-Retry">Spring-Retry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/Springboot加载自定义配置文件">Springboot加载自定义配置文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/my-website/docs/spring/spring-websocket">WebSocket 的 6 种集成方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/springboot项目打包jar">springboot项目打包</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/springboot项目打包瘦身">springboot项目打包瘦身</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/spring注入bean的四种方式">spring注入bean的四种方式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/spring/websocket_stomp">websocket_stomp</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-website/docs/swagger/swagger-editor生成api文件">swagger</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/my-website/docs/uml/plantuml简介">uml</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/文档">文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/语言学习">语言学习</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/my-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">spring</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">WebSocket 的 6 种集成方式</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>WebSocket 的 6 种集成方式</h1>
<h1>介绍</h1>
<p><code>WebSocket</code>的各种集成方式目前主要有以下几种</p>
<ul>
<li><code>Javax</code></li>
<li><code>WebMVC</code></li>
<li><code>WebFlux</code></li>
<li><code>Java-WebSocket</code></li>
<li><code>SocketIO</code></li>
<li><code>Netty</code></li>
</ul>
<p>今天主要介绍一下前3种方式，毕竟现在的主流框架还是<code>Spring Boot</code></p>
<p>而后3种其实和<code>Spring Boot</code>并不强行绑定，基于<code>Java</code>就可以支持，不过我也会对后3种做个简单的介绍，大家先混个眼熟就行了</p>
<p>那么接下来我们就来讲讲前3种方式（<code>Javax</code>，<code>WebMVC</code>，<code>WebFlux</code>）在<code>Spring Boot</code>中的服务端和客户端配置（客户端配置也超重要的有木有，平时用不到，用到了却基本找不到文档，这也太绝望了）</p>
<h1>Javax</h1>
<p>在<code>java</code>的扩展包<code>javax.websocket</code>中就定义了一套<code>WebSocket</code>的接口规范</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务端">服务端<a class="hash-link" aria-label="Direct link to 服务端" title="Direct link to 服务端" href="/my-website/docs/spring/spring-websocket#服务端">​</a></h2>
<p>一般使用注解的方式来进行配置</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步">​</a></h3>
<p>java</p>
<p>复制代码</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ServerEndpoint(&quot;/websocket/{type}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JavaxWebSocketServerEndpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnOpen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onOpen(Session session, EndpointConfig config,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       @PathParam(value = &quot;type&quot;) String type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接建立</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnClose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onClose(Session session, CloseReason reason) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收文本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, PongMessage message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收pong信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, ByteBuffer message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收二进制信息，也可以用byte[]接收</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(Session session, Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们在类上添加<code>@ServerEndpoint</code>注解来表示这是一个服务端点，同时可以在注解中配置路径，这个路径可以配置成动态的，使用<code>{}</code>包起来就可以了</p>
<p><code>@OnOpen</code>用来标记对应的方法作为客户端连接上来之后的回调，<code>Session</code>就相当于和客户端的连接啦，我们可以把它缓存起来用于发送消息；通过<code>@PathParam</code>注解就可以获得动态路径中对应值了</p>
<p><code>@OnClose</code>用来标记对应的方法作为客户端断开连接之后的回调，我们可以在这个方法中移除对应<code>Session</code>的缓存，同时可以接受一个<code>CloseReason</code>的参数用于获取关闭原因</p>
<p><code>@OnMessage</code>用来标记对应的方法作为接收到消息之后的回调，我们可以接受文本消息，二进制消息和<code>pong</code>消息</p>
<p><code>@OnError</code>用来标记对应的方法作为抛出异常之后的回调，可以获得对应的<code>Session</code>和异常对象</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第二步">​</a></h3>
<div class="language-maven codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-maven codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JavaxWebSocketConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ServerEndpointExporter serverEndpointExporter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new ServerEndpointExporter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>依赖<code>Spring</code>的<code>WebSocket</code>模块，手动注入<code>ServerEndpointExporter</code>就可以了</p>
<p>需要注意<code>ServerEndpointExporter</code>是<code>Spring</code>中的类，算是<code>Spring</code>为了支持<code>javax.websocket</code>的原生用法所提供的支持类</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识">​</a></h3>
<p><code>javax.websocket</code>库中定义了<code>PongMessage</code>而没有<code>PingMessage</code></p>
<p>通过我的测试发现基本上所有的<code>WebSocket</code>包括前端<code>js</code>自带的，都实现了自动回复；也就是说当接收到一个<code>ping</code>消息之后，是会自动回应一个<code>pong</code>消息，所以没有必要再自己接受<code>ping</code>消息来处理了，即我们不会接受到<code>ping</code>消息</p>
<p>当然我上面讲的<code>ping</code>和<code>pong</code>都是需要使用框架提供的<code>api</code>，如果是我们自己通过<code>Message</code>来自定义心跳数据的话是没有任何的处理的，下面是对应的<code>api</code></p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//发送ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendPing(ByteBuffer buffer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送pong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendPong(ByteBuffer buffer);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后我又发现<code>js</code>自带的<code>WebSocket</code>是没有发送<code>ping</code>的<code>api</code>的，所以是不是可以猜想当初就是约定服务端发送<code>ping</code>，客户端回复<code>pong</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端">客户端<a class="hash-link" aria-label="Direct link to 客户端" title="Direct link to 客户端" href="/my-website/docs/spring/spring-websocket#客户端">​</a></h2>
<p>客户端也是使用注解配置</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步-1">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步-1">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@ClientEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JavaxWebSocketClientEndpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnOpen</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onOpen(Session session) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接建立</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnClose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onClose(Session session, CloseReason reason) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收文本消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, PongMessage message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收pong消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onMessage(Session session, ByteBuffer message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @OnError</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void onError(Session session, Throwable e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>客户端使用<code>@ClientEndpoint</code>来标记，其他的<code>@OnOpen</code>，<code>@OnClose</code>，<code>@OnMessage</code>，<code>@OnError</code>和服务端一模一样</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步-1">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第 二步-1">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketContainer container = ContainerProvider.getWebSocketContainer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session session = container.connectToServer(JavaxWebSocketClientEndpoint.class, uri);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们可以通过<code>ContainerProvider</code>来获得一个<code>WebSocketContainer</code>，然后调用<code>connectToServer</code>方法将我们的客户端类和连接的<code>uri</code>传入就行了</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识-1">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识-1">​</a></h3>
<p>通过<code>ContainerProvider#getWebSocketContainer</code>获得<code>WebSocketContainer</code>其实是基于<code>SPI</code>实现的</p>
<p>在<code>Spring</code>的环境  中我更推荐大家使用<code>ServletContextAware</code>来获得，代码如下</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class JavaxWebSocketContainer implements ServletContextAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private volatile WebSocketContainer container;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public WebSocketContainer getContainer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (container == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            synchronized (this) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (container == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    container = ContainerProvider.getWebSocketContainer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return container;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setServletContext(@NonNull ServletContext servletContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (container == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            container = (WebSocketContainer) servletContext</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .getAttribute(&quot;javax.websocket.server.ServerContainer&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="发消息">发消息<a class="hash-link" aria-label="Direct link to 发消息" title="Direct link to 发消息" href="/my-website/docs/spring/spring-websocket#发消息">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Session session = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送文本消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendText(String message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendBinary(ByteBuffer message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送对象消息，会尝试使用Encoder编码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendObject(Object message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendPing(ByteBuffer buffer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送pong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.getAsyncRemote().sendPong(ByteBuffer buffer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>WebMVC</h1>
<p>依赖肯定是必不可少的</p>
<div class="language-maven codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-maven codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务端-1">服务端<a class="hash-link" aria-label="Direct link to 服务端" title="Direct link to 服务端" href="/my-website/docs/spring/spring-websocket#服务端-1">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步-2">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步-2">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.socket.WebSocketHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.socket.WebSocketMessage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.socket.WebSocketSession;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletWebSocketServerHandler implements WebSocketHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterConnectionEstablished(@NonNull WebSocketSession session) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接建立</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleMessage(@NonNull WebSocketSession session, @NonNull WebSocketMessage&lt;?&gt; message) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleTransportError(@NonNull WebSocketSession session, @NonNull Throwable exception) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterConnectionClosed(@NonNull WebSocketSession session, @NonNull CloseStatus closeStatus) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean supportsPartialMessages() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //是否支持接收不完整的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们实现一个<code>WebSocketHandler</code>来处理<code>WebSocket</code>的连接，关闭，消息和异常</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步-2">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第二步-2">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletWebSocketServerConfigurer implements WebSocketConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //添加处理器到对应的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addHandler(new ServletWebSocketServerHandler(), &quot;/websocket&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setAllowedOrigins(&quot;*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>首先需要添加<code>@EnableWebSocket</code>来启用<code>WebSocket</code></p>
<p>然后实现<code>WebSocketConfigurer</code>来注册<code>WebSocket</code>路径以及对应的<code>WebSocketHandler</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="握手拦截">握手拦截<a class="hash-link" aria-label="Direct link to 握手拦截" title="Direct link to 握手拦截" href="/my-website/docs/spring/spring-websocket#握手拦截">​</a></h3>
<p>提供了<code>HandshakeInterceptor</code>来拦截握手</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletWebSocketServerConfigurer implements WebSocketConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //添加处理器到对应的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addHandler(new ServletWebSocketServerHandler(), &quot;/websocket&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //添加握手拦截器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addInterceptors(new ServletWebSocketHandshakeInterceptor())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setAllowedOrigins(&quot;*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class ServletWebSocketHandshakeInterceptor implements HandshakeInterceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public boolean beforeHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //握手之前</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //继续握手返回true, 中断握手返回false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void afterHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception exception) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //握手之后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识-2">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识-2">​</a></h3>
<p>我在集成的时候发现这种方式没办法动态匹配路径，它的路径就是固定的，没办法使用如<code>/websocket/**</code>这样的通配符</p>
<p>我在研究了一下之后发现可以在<code>UrlPathHelper</code>上做点文章</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableWebSocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletWebSocketServerConfigurer implements WebSocketConfigurer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (registry instanceof ServletWebSocketHandlerRegistry) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //替换UrlPathHelper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((ServletWebSocketHandlerRegistry) registry)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .setUrlPathHelper(new PrefixUrlPathHelper(&quot;/websocket&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //添加处理器到对应的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addHandler(new ServletWebSocketServerHandler(), &quot;/websocket/**&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .setAllowedOrigins(&quot;*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class PrefixUrlPathHelper extends UrlPathHelper {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private String prefix;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public @NonNull String resolveAndCacheLookupPath(@NonNull HttpServletRequest request) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //获得原本的Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String path = super.resolveAndCacheLookupPath(request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //如果是指定前缀就返回对应的通配路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (path.startsWith(prefix)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return prefix + &quot;/**&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>因为它内部实际上就是用一个<code>Map&lt;String, WebSocketHandler&gt;</code>来存的，所以没有办法用通配符</p>
<p>主要是有现成的<code>AntPathMatcher</code>实现通配应该不麻烦才对啊</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端-1">客户端<a class="hash-link" aria-label="Direct link to 客户端" title="Direct link to 客户端" href="/my-website/docs/spring/spring-websocket#客户端-1">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步-3">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步-3">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ServletWebSocketClientHandler implements WebSocketHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterConnectionEstablished(@NonNull WebSocketSession session) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接建立</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleMessage(@NonNull WebSocketSession session, @NonNull WebSocketMessage&lt;?&gt; message) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //接收消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleTransportError(@NonNull WebSocketSession session, @NonNull Throwable exception) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void afterConnectionClosed(@NonNull WebSocketSession session, @NonNull CloseStatus closeStatus) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean supportsPartialMessages() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //是否支持接收不完整的消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>和服务端一样我们需要先实现一个<code>WebSocketHandler</code>来处理<code>WebSocket</code>的连接，关闭，消息和异常</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步-3">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第二步-3">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketClient client = new StandardWebSocketClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketHandler handler = new ServletWebSocketClientHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketConnectionManager manager = new WebSocketConnectionManager(client, handler, uri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">manager.start();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>首先我们需要先<code>new</code>一个<code>StandardWebSocketClient</code>，可以传入一个<code>WebSocketContainer</code>参数，获得该对象的方式我之前已经介绍过了，这边就先略过</p>
<p>然后<code>new</code>一个<code>WebSocketConnectionManager</code>传入<code>WebSocketClient</code>，<code>WebSocketHandler</code>还有路径<code>uri</code></p>
<p>最后调用一下<code>WebSocketConnectionManager</code>的<code>start</code>方法就可以啦</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识-3">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识-3">​</a></h3>
<p>这里如果大家去看<code>WebSocketClient</code>的实现类就会发现有<code>StandardWebSocketClient</code>还有<code>JettyWebSocketClient</code>等等，所以大家可以根据自身项目所使用的容器来选择不同的<code>WebSocketClient</code>实现类</p>
<p>这里给大家贴一小段<code>Spring</code>适配不同容器<code>WebSocket</code>的代码</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class AbstractHandshakeHandler implements HandshakeHandler, Lifecycle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean tomcatWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean jettyWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean jetty10WsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean undertowWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean glassfishWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean weblogicWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean websphereWsPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader classLoader = AbstractHandshakeHandler.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tomcatWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;org.apache.tomcat.websocket.server.WsHttpUpgradeHandler&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jetty10WsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;org.eclipse.jetty.websocket.server.JettyWebSocketServerContainer&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jettyWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;org.eclipse.jetty.websocket.server.WebSocketServerFactory&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        undertowWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;io.undertow.websockets.jsr.ServerWebSocketContainer&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        glassfishWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;org.glassfish.tyrus.servlet.TyrusHttpUpgradeHandler&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weblogicWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;weblogic.websocket.tyrus.TyrusServletWriter&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        websphereWsPresent = ClassUtils.isPresent(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;com.ibm.websphere.wsoc.WsWsocServerContainer&quot;, classLoader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="发消息-1">发消息<a class="hash-link" aria-label="Direct link to 发消息" title="Direct link to 发消息" href="/my-website/docs/spring/spring-websocket#发消息-1">​</a></h2>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.socket.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketSession session = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送文本消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.sendMessage(new TextMessage(CharSequence message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.sendMessage(new BinaryMessage(ByteBuffer message));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.sendMessage(new PingMessage(ByteBuffer message));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//发送pong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">session.sendMessage(new PongMessage(ByteBuffer message));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>WebFlux</h1>
<p><code>WebFlux</code>的<code>WebSocket</code>不需要额外的依赖包</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务端-2">服务端<a class="hash-link" aria-label="Direct link to 服务端" title="Direct link to 服务端" href="/my-website/docs/spring/spring-websocket#服务端-2">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步-4">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步-4">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.WebSocketHandler;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.WebSocketSession;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReactiveWebSocketServerHandler implements WebSocketHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @NonNull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;Void&gt; handle(WebSocketSession session) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mono&lt;Void&gt; send = session.send(Flux.create(sink -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //可以持有sink对象在任意时候调用next发送消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sink.next(WebSocketMessage message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })).doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mono&lt;Void&gt; receive = session.receive()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnNext(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //接收消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .then();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @SuppressWarnings(&quot;all&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Disposable disposable = session.closeStatus()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .subscribe(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Mono.zip(send, receive).then();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>首先需要注意这里的<code>WebSocketHandler</code>和<code>WebSocketSession</code>是<code>reactive</code>包下的</p>
<p>通过<code>WebSocketSession#send</code>方法来持有一个<code>FluxSink&lt;WebSocketMessage&gt;</code>来用于发送消息</p>
<p>通过<code>WebSocketSession#receive</code>来订阅消息</p>
<p>通过<code>WebSocketSession#closeStatus</code>来订阅连接关闭事件</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步-4">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第二步-4">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReactiveWebSocketServerHandlerMapping extends SimpleUrlHandlerMapping {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ReactiveWebSocketServerHandlerMapping() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, WebSocketHandler&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(&quot;/websocket/**&quot;, new ReactiveWebSocketServerHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setUrlMap(map);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setOrder(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注册一个<code>HandlerMapping</code>同时配置路径和对应的<code>WebSocketHandler</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第三步">第三步<a class="hash-link" aria-label="Direct link to 第三步" title="Direct link to 第三步" href="/my-website/docs/spring/spring-websocket#第三步">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration(proxyBeanMethods = false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReactiveWebSocketConfiguration {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public WebSocketHandlerAdapter webSocketHandlerAdapter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new WebSocketHandlerAdapter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注入<code>WebSocketHandlerAdapter</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识-4">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识-4">​</a></h3>
<p>我们自定义的<code>HandlerMapping</code>需要设置<code>order</code>，如果不设置，默认为<code>Ordered.LOWEST_PRECEDENCE</code>，会导致这个<code>HandlerMapping</code>被放在最后，当有客户端连接上来时会被其他的<code>HandlerMapping</code>优先匹配上而连接失败</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="客户端-2">客户端<a class="hash-link" aria-label="Direct link to 客户端" title="Direct link to 客户端" href="/my-website/docs/spring/spring-websocket#客户端-2">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步-5">第一步<a class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步" href="/my-website/docs/spring/spring-websocket#第一步-5">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ReactiveWebSocketClientHandler implements WebSocketHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @NonNull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Mono&lt;Void&gt; handle(WebSocketSession session) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mono&lt;Void&gt; send = session.send(Flux.create(sink -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //可以持有sink对象在任意时候调用next发送消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sink.next(WebSocketMessage message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })).doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //处理异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Mono&lt;Void&gt; receive = session.receive()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnNext(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //接收消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .then();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @SuppressWarnings(&quot;all&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Disposable disposable = session.closeStatus()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .doOnError(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //异常处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .subscribe(it -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    //连接关闭</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Mono.zip(send, receive).then();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>客户端<code>WebSocketHandler</code>的写法和服务端的一样</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步-5">第二步<a class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步" href="/my-website/docs/spring/spring-websocket#第二步-5">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.client.WebSocketClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketClient client = ReactorNettyWebSocketClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WebSocketHandler handler = new ReactiveWebSocketClientHandler();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client.execute(uri, handler).subscribe();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>首先我们需要先<code>new</code>一个<code>ReactorNettyWebSocketClient</code></p>
<p>然后调用一下<code>WebSocketClient</code>的<code>execute</code>方法传入路径<code>uri</code>和<code>WebSocketHandler</code>并继续调用<code>subscribe</code>方法就行啦</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="冷知识-5">冷知识<a class="hash-link" aria-label="Direct link to 冷知识" title="Direct link to 冷知识" href="/my-website/docs/spring/spring-websocket#冷知识-5">​</a></h3>
<p>和<code>WebMVC</code>中的<code>WebSocketClient</code>一样，<code>Reactive</code>包中的<code>WebSocketClient</code>也有很多实现类，比如<code>ReactorNettyWebSocketClient</code>，<code>JettyWebSocketClient</code>，<code>UndertowWebSocketClient</code>，<code>TomcatWebSocketClient</code>等等，也是需要大家基于自身项目的容器使用不同的实现类</p>
<p>这里也给大家贴一小段<code>Reactive</code>适配不同容器<code>WebSocket</code>的代码</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class HandshakeWebSocketService implements WebSocketService, Lifecycle {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean tomcatPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean jettyPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean jetty10Present;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean undertowPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final boolean reactorNettyPresent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClassLoader loader = HandshakeWebSocketService.class.getClassLoader();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tomcatPresent = ClassUtils.isPresent(&quot;org.apache.tomcat.websocket.server.WsHttpUpgradeHandler&quot;, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jettyPresent = ClassUtils.isPresent(&quot;org.eclipse.jetty.websocket.server.WebSocketServerFactory&quot;, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jetty10Present = ClassUtils.isPresent(&quot;org.eclipse.jetty.websocket.server.JettyWebSocketServerContainer&quot;, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        undertowPresent = ClassUtils.isPresent(&quot;io.undertow.websockets.WebSocketProtocolHandshakeHandler&quot;, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reactorNettyPresent = ClassUtils.isPresent(&quot;reactor.netty.http.server.HttpServerResponse&quot;, loader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="发消息-2">发消息<a class="hash-link" aria-label="Direct link to 发消息" title="Direct link to 发消息" href="/my-website/docs/spring/spring-websocket#发消息-2">​</a></h2>
<p>我们需要使用在<code>WebSocketHandler</code>中获得的<code>FluxSink&lt;WebSocketMessage&gt;</code>来发送消息</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.CloseStatus;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.WebSocketMessage;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.reactive.socket.WebSocketSession;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReactiveWebSocket {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final WebSocketSession session;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final FluxSink&lt;WebSocketMessage&gt; sender;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ReactiveWebSocket(WebSocketSession session, FluxSink&lt;WebSocketMessage&gt; sender) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.session = session;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.sender = sender;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getId() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return session.getId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public URI getUri() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return session.getHandshakeInfo().getUri();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void send(Object message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (message instanceof WebSocketMessage) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sender.next((WebSocketMessage) message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (message instanceof String) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //发送文本消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sender.next(session.textMessage((String) message));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (message instanceof DataBuffer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //发送二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sender.next(session.binaryMessage(factory -&gt; (DataBuffer) message));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (message instanceof ByteBuffer) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ////发送二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sender.next(session.binaryMessage(factory -&gt; factory.wrap((ByteBuffer) message)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (message instanceof byte[]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ////发送二进制消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sender.next(session.binaryMessage(factory -&gt; factory.wrap((byte[]) message)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalArgumentException(&quot;Message type not match&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void ping() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //发送ping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sender.next(session.pingMessage(factory -&gt; factory.wrap(ByteBuffer.allocate(0))));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void pong() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //发送pong</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sender.next(session.pongMessage(factory -&gt; factory.wrap(ByteBuffer.allocate(0))));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void close(CloseStatus reason) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sender.complete();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        session.close(reason).subscribe();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Java-WebSocket</h1>
<p>这是一个纯<code>java</code>的第三方库，专门用于实现<code>WebSocket</code></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTooTallNate%2FJava-WebSocket" target="_blank" rel="noopener noreferrer" title="https://github.com/TooTallNate/Java-WebSocket">Github</a>上已经有很详细的使用教程了，现在有<code>9k+</code>的<code>Star</code></p>
<h1>SocketIO</h1>
<p>该库使用的协议是经过自己封装的，支持很多的语言，提供了统一的接口，所以需要使用它提供的<code>Server</code>和<code>Client</code>来连接，如<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio%2Fsocket.io-server-java" target="_blank" rel="noopener noreferrer" title="https://github.com/socketio/socket.io-server-java">socket.io-server-java</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio%2Fsocket.io-client-java" target="_blank" rel="noopener noreferrer" title="https://github.com/socketio/socket.io-client-java">socket.io-client-java</a></p>
<p>这个库我了解下来主要用于实时聊天等场景，所以如果只是普通的<code>WebSocket</code>功能就有点大材小用了</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio" target="_blank" rel="noopener noreferrer" title="https://github.com/socketio">Github</a>上也有非常详细的使用文档，大家如果有兴趣可以研究一下</p>
<h1>Netty</h1>
<p>这个大家应该都比较熟悉了，就算没用过肯定也听过</p>
<p>网上的文档和示例也非常多，我这里就不介绍有的没的了，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty" target="_blank" rel="noopener noreferrer" title="https://github.com/netty/netty">Github传送门</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/spring/spring-websocket.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/my-website/docs/spring/Springboot加载自定义配置文件"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Springboot加载自定义配置文件</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/my-website/docs/spring/springboot项目打包jar"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">springboot项目打包</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#服务端">服务端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#客户端">客户端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步-1">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步-1">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识-1">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#发消息">发消息</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#服务端-1">服务端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步-2">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步-2">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#握手拦截">握手拦截</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识-2">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#客户端-1">客户端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步-3">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步-3">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识-3">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#发消息-1">发消息</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#服务端-2">服务端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步-4">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步-4">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第三步">第三步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识-4">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#客户端-2">客户端</a><ul><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第一步-5">第一步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#第二步-5">第二步</a></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#冷知识-5">冷知识</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/my-website/docs/spring/spring-websocket#发消息-2">发消息</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-website/docs/框架学习">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/my-website/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>