"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9854],{6796:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>a});var r=s(4848),i=s(8453);const o={},t="WebSocket \u7684 6 \u79cd\u96c6\u6210\u65b9\u5f0f",c={id:"spring/spring-websocket",title:"WebSocket \u7684 6 \u79cd\u96c6\u6210\u65b9\u5f0f",description:"\u4ecb\u7ecd",source:"@site/docs/spring/spring-websocket.md",sourceDirName:"spring",slug:"/spring/spring-websocket",permalink:"/my-website/docs/spring/spring-websocket",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/spring/spring-websocket.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Springboot\u52a0\u8f7d\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6",permalink:"/my-website/docs/spring/Springboot\u52a0\u8f7d\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6"},next:{title:"springboot\u9879\u76ee\u6253\u5305",permalink:"/my-website/docs/spring/springboot\u9879\u76ee\u6253\u5305jar"}},l={},a=[{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6",level:3},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65-1",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65-1",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6-1",level:3},{value:"\u53d1\u6d88\u606f",id:"\u53d1\u6d88\u606f",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-1",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65-2",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65-2",level:3},{value:"\u63e1\u624b\u62e6\u622a",id:"\u63e1\u624b\u62e6\u622a",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6-2",level:3},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-1",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65-3",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65-3",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6-3",level:3},{value:"\u53d1\u6d88\u606f",id:"\u53d1\u6d88\u606f-1",level:2},{value:"\u670d\u52a1\u7aef",id:"\u670d\u52a1\u7aef-2",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65-4",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65-4",level:3},{value:"\u7b2c\u4e09\u6b65",id:"\u7b2c\u4e09\u6b65",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6-4",level:3},{value:"\u5ba2\u6237\u7aef",id:"\u5ba2\u6237\u7aef-2",level:2},{value:"\u7b2c\u4e00\u6b65",id:"\u7b2c\u4e00\u6b65-5",level:3},{value:"\u7b2c\u4e8c\u6b65",id:"\u7b2c\u4e8c\u6b65-5",level:3},{value:"\u51b7\u77e5\u8bc6",id:"\u51b7\u77e5\u8bc6-5",level:3},{value:"\u53d1\u6d88\u606f",id:"\u53d1\u6d88\u606f-2",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"websocket-\u7684-6-\u79cd\u96c6\u6210\u65b9\u5f0f",children:"WebSocket \u7684 6 \u79cd\u96c6\u6210\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.h1,{id:"\u4ecb\u7ecd",children:"\u4ecb\u7ecd"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u5404\u79cd\u96c6\u6210\u65b9\u5f0f\u76ee\u524d\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Javax"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"WebMVC"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"WebFlux"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Java-WebSocket"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SocketIO"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"Netty"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4eca\u5929\u4e3b\u8981\u4ecb\u7ecd\u4e00\u4e0b\u524d3\u79cd\u65b9\u5f0f\uff0c\u6bd5\u7adf\u73b0\u5728\u7684\u4e3b\u6d41\u6846\u67b6\u8fd8\u662f",(0,r.jsx)(n.code,{children:"Spring Boot"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u800c\u540e3\u79cd\u5176\u5b9e\u548c",(0,r.jsx)(n.code,{children:"Spring Boot"}),"\u5e76\u4e0d\u5f3a\u884c\u7ed1\u5b9a\uff0c\u57fa\u4e8e",(0,r.jsx)(n.code,{children:"Java"}),"\u5c31\u53ef\u4ee5\u652f\u6301\uff0c\u4e0d\u8fc7\u6211\u4e5f\u4f1a\u5bf9\u540e3\u79cd\u505a\u4e2a\u7b80\u5355\u7684\u4ecb\u7ecd\uff0c\u5927\u5bb6\u5148\u6df7\u4e2a\u773c\u719f\u5c31\u884c\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:["\u90a3\u4e48\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u8bb2\u8bb2\u524d3\u79cd\u65b9\u5f0f\uff08",(0,r.jsx)(n.code,{children:"Javax"}),"\uff0c",(0,r.jsx)(n.code,{children:"WebMVC"}),"\uff0c",(0,r.jsx)(n.code,{children:"WebFlux"}),"\uff09\u5728",(0,r.jsx)(n.code,{children:"Spring Boot"}),"\u4e2d\u7684\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u914d\u7f6e\uff08\u5ba2\u6237\u7aef\u914d\u7f6e\u4e5f\u8d85\u91cd\u8981\u7684\u6709\u6728\u6709\uff0c\u5e73\u65f6\u7528\u4e0d\u5230\uff0c\u7528\u5230\u4e86\u5374\u57fa\u672c\u627e\u4e0d\u5230\u6587\u6863\uff0c\u8fd9\u4e5f\u592a\u7edd\u671b\u4e86\uff09"]}),"\n",(0,r.jsx)(n.h1,{id:"javax",children:"Javax"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728",(0,r.jsx)(n.code,{children:"java"}),"\u7684\u6269\u5c55\u5305",(0,r.jsx)(n.code,{children:"javax.websocket"}),"\u4e2d\u5c31\u5b9a\u4e49\u4e86\u4e00\u5957",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u63a5\u53e3\u89c4\u8303"]}),"\n",(0,r.jsx)(n.h2,{id:"\u670d\u52a1\u7aef",children:"\u670d\u52a1\u7aef"}),"\n",(0,r.jsx)(n.p,{children:"\u4e00\u822c\u4f7f\u7528\u6ce8\u89e3\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.p,{children:"java"}),"\n",(0,r.jsx)(n.p,{children:"\u590d\u5236\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\n@ServerEndpoint("/websocket/{type}")\npublic class JavaxWebSocketServerEndpoint {\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config,\n                       @PathParam(value = "type") String type) {\n        //\u8fde\u63a5\u5efa\u7acb\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        //\u8fde\u63a5\u5173\u95ed\n    }\n\n    @OnMessage\n    public void onMessage(Session session, String message) {\n        //\u63a5\u6536\u6587\u672c\u4fe1\u606f\n    }\n\n    @OnMessage\n    public void onMessage(Session session, PongMessage message) {\n        //\u63a5\u6536pong\u4fe1\u606f\n    }\n\n    @OnMessage\n    public void onMessage(Session session, ByteBuffer message) {\n        //\u63a5\u6536\u4e8c\u8fdb\u5236\u4fe1\u606f\uff0c\u4e5f\u53ef\u4ee5\u7528byte[]\u63a5\u6536\n    }\n\n    @OnError\n    public void onError(Session session, Throwable e) {\n        //\u5f02\u5e38\u5904\u7406\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u5728\u7c7b\u4e0a\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"@ServerEndpoint"}),"\u6ce8\u89e3\u6765\u8868\u793a\u8fd9\u662f\u4e00\u4e2a\u670d\u52a1\u7aef\u70b9\uff0c\u540c\u65f6\u53ef\u4ee5\u5728\u6ce8\u89e3\u4e2d\u914d\u7f6e\u8def\u5f84\uff0c\u8fd9\u4e2a\u8def\u5f84\u53ef\u4ee5\u914d\u7f6e\u6210\u52a8\u6001\u7684\uff0c\u4f7f\u7528",(0,r.jsx)(n.code,{children:"{}"}),"\u5305\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@OnOpen"}),"\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684\u65b9\u6cd5\u4f5c\u4e3a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0a\u6765\u4e4b\u540e\u7684\u56de\u8c03\uff0c",(0,r.jsx)(n.code,{children:"Session"}),"\u5c31\u76f8\u5f53\u4e8e\u548c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5566\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u7f13\u5b58\u8d77\u6765\u7528\u4e8e\u53d1\u9001\u6d88\u606f\uff1b\u901a\u8fc7",(0,r.jsx)(n.code,{children:"@PathParam"}),"\u6ce8\u89e3\u5c31\u53ef\u4ee5\u83b7\u5f97\u52a8\u6001\u8def\u5f84\u4e2d\u5bf9\u5e94\u503c\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@OnClose"}),"\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684\u65b9\u6cd5\u4f5c\u4e3a\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u4e4b\u540e\u7684\u56de\u8c03\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u79fb\u9664\u5bf9\u5e94",(0,r.jsx)(n.code,{children:"Session"}),"\u7684\u7f13\u5b58\uff0c\u540c\u65f6\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"CloseReason"}),"\u7684\u53c2\u6570\u7528\u4e8e\u83b7\u53d6\u5173\u95ed\u539f\u56e0"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@OnMessage"}),"\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684\u65b9\u6cd5\u4f5c\u4e3a\u63a5\u6536\u5230\u6d88\u606f\u4e4b\u540e\u7684\u56de\u8c03\uff0c\u6211\u4eec\u53ef\u4ee5\u63a5\u53d7\u6587\u672c\u6d88\u606f\uff0c\u4e8c\u8fdb\u5236\u6d88\u606f\u548c",(0,r.jsx)(n.code,{children:"pong"}),"\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@OnError"}),"\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684\u65b9\u6cd5\u4f5c\u4e3a\u629b\u51fa\u5f02\u5e38\u4e4b\u540e\u7684\u56de\u8c03\uff0c\u53ef\u4ee5\u83b7\u5f97\u5bf9\u5e94\u7684",(0,r.jsx)(n.code,{children:"Session"}),"\u548c\u5f02\u5e38\u5bf9\u8c61"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-maven",children:" <dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Configuration(proxyBeanMethods = false)\npublic class JavaxWebSocketConfiguration {\n\n    @Bean\n    public ServerEndpointExporter serverEndpointExporter() {\n        return new ServerEndpointExporter();\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f9d\u8d56",(0,r.jsx)(n.code,{children:"Spring"}),"\u7684",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u6a21\u5757\uff0c\u624b\u52a8\u6ce8\u5165",(0,r.jsx)(n.code,{children:"ServerEndpointExporter"}),"\u5c31\u53ef\u4ee5\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:["\u9700\u8981\u6ce8\u610f",(0,r.jsx)(n.code,{children:"ServerEndpointExporter"}),"\u662f",(0,r.jsx)(n.code,{children:"Spring"}),"\u4e2d\u7684\u7c7b\uff0c\u7b97\u662f",(0,r.jsx)(n.code,{children:"Spring"}),"\u4e3a\u4e86\u652f\u6301",(0,r.jsx)(n.code,{children:"javax.websocket"}),"\u7684\u539f\u751f\u7528\u6cd5\u6240\u63d0\u4f9b\u7684\u652f\u6301\u7c7b"]}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"javax.websocket"}),"\u5e93\u4e2d\u5b9a\u4e49\u4e86",(0,r.jsx)(n.code,{children:"PongMessage"}),"\u800c\u6ca1\u6709",(0,r.jsx)(n.code,{children:"PingMessage"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7\u6211\u7684\u6d4b\u8bd5\u53d1\u73b0\u57fa\u672c\u4e0a\u6240\u6709\u7684",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u5305\u62ec\u524d\u7aef",(0,r.jsx)(n.code,{children:"js"}),"\u81ea\u5e26\u7684\uff0c\u90fd\u5b9e\u73b0\u4e86\u81ea\u52a8\u56de\u590d\uff1b\u4e5f\u5c31\u662f\u8bf4\u5f53\u63a5\u6536\u5230\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"ping"}),"\u6d88\u606f\u4e4b\u540e\uff0c\u662f\u4f1a\u81ea\u52a8\u56de\u5e94\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"pong"}),"\u6d88\u606f\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\u518d\u81ea\u5df1\u63a5\u53d7",(0,r.jsx)(n.code,{children:"ping"}),"\u6d88\u606f\u6765\u5904\u7406\u4e86\uff0c\u5373\u6211\u4eec\u4e0d\u4f1a\u63a5\u53d7\u5230",(0,r.jsx)(n.code,{children:"ping"}),"\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u7136\u6211\u4e0a\u9762\u8bb2\u7684",(0,r.jsx)(n.code,{children:"ping"}),"\u548c",(0,r.jsx)(n.code,{children:"pong"}),"\u90fd\u662f\u9700\u8981\u4f7f\u7528\u6846\u67b6\u63d0\u4f9b\u7684",(0,r.jsx)(n.code,{children:"api"}),"\uff0c\u5982\u679c\u662f\u6211\u4eec\u81ea\u5df1\u901a\u8fc7",(0,r.jsx)(n.code,{children:"Message"}),"\u6765\u81ea\u5b9a\u4e49\u5fc3\u8df3\u6570\u636e\u7684\u8bdd\u662f\u6ca1\u6709\u4efb\u4f55\u7684\u5904\u7406\u7684\uff0c\u4e0b\u9762\u662f\u5bf9\u5e94\u7684",(0,r.jsx)(n.code,{children:"api"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"//\u53d1\u9001ping\nsession.getAsyncRemote().sendPing(ByteBuffer buffer);\n\n//\u53d1\u9001pong\nsession.getAsyncRemote().sendPong(ByteBuffer buffer);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u6211\u53c8\u53d1\u73b0",(0,r.jsx)(n.code,{children:"js"}),"\u81ea\u5e26\u7684",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u662f\u6ca1\u6709\u53d1\u9001",(0,r.jsx)(n.code,{children:"ping"}),"\u7684",(0,r.jsx)(n.code,{children:"api"}),"\u7684\uff0c\u6240\u4ee5\u662f\u4e0d\u662f\u53ef\u4ee5\u731c\u60f3\u5f53\u521d\u5c31\u662f\u7ea6\u5b9a\u670d\u52a1\u7aef\u53d1\u9001",(0,r.jsx)(n.code,{children:"ping"}),"\uff0c\u5ba2\u6237\u7aef\u56de\u590d",(0,r.jsx)(n.code,{children:"pong"})]}),"\n",(0,r.jsx)(n.h2,{id:"\u5ba2\u6237\u7aef",children:"\u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.p,{children:"\u5ba2\u6237\u7aef\u4e5f\u662f\u4f7f\u7528\u6ce8\u89e3\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65-1",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@ClientEndpoint\npublic class JavaxWebSocketClientEndpoint {\n\n    @OnOpen\n    public void onOpen(Session session) {\n        //\u8fde\u63a5\u5efa\u7acb\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        //\u8fde\u63a5\u5173\u95ed\n    }\n\n    @OnMessage\n    public void onMessage(Session session, String message) {\n        //\u63a5\u6536\u6587\u672c\u6d88\u606f\n    }\n\n    @OnMessage\n    public void onMessage(Session session, PongMessage message) {\n        //\u63a5\u6536pong\u6d88\u606f\n    }\n\n    @OnMessage\n    public void onMessage(Session session, ByteBuffer message) {\n        //\u63a5\u6536\u4e8c\u8fdb\u5236\u6d88\u606f\n    }\n\n    @OnError\n    public void onError(Session session, Throwable e) {\n        //\u5f02\u5e38\u5904\u7406\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5ba2\u6237\u7aef\u4f7f\u7528",(0,r.jsx)(n.code,{children:"@ClientEndpoint"}),"\u6765\u6807\u8bb0\uff0c\u5176\u4ed6\u7684",(0,r.jsx)(n.code,{children:"@OnOpen"}),"\uff0c",(0,r.jsx)(n.code,{children:"@OnClose"}),"\uff0c",(0,r.jsx)(n.code,{children:"@OnMessage"}),"\uff0c",(0,r.jsx)(n.code,{children:"@OnError"}),"\u548c\u670d\u52a1\u7aef\u4e00\u6a21\u4e00\u6837"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65-1",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\nWebSocketContainer container = ContainerProvider.getWebSocketContainer();\nSession session = container.connectToServer(JavaxWebSocketClientEndpoint.class, uri);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7",(0,r.jsx)(n.code,{children:"ContainerProvider"}),"\u6765\u83b7\u5f97\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"WebSocketContainer"}),"\uff0c\u7136\u540e\u8c03\u7528",(0,r.jsx)(n.code,{children:"connectToServer"}),"\u65b9\u6cd5\u5c06\u6211\u4eec\u7684\u5ba2\u6237\u7aef\u7c7b\u548c\u8fde\u63a5\u7684",(0,r.jsx)(n.code,{children:"uri"}),"\u4f20\u5165\u5c31\u884c\u4e86"]}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6-1",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7",(0,r.jsx)(n.code,{children:"ContainerProvider#getWebSocketContainer"}),"\u83b7\u5f97",(0,r.jsx)(n.code,{children:"WebSocketContainer"}),"\u5176\u5b9e\u662f\u57fa\u4e8e",(0,r.jsx)(n.code,{children:"SPI"}),"\u5b9e\u73b0\u7684"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728",(0,r.jsx)(n.code,{children:"Spring"}),"\u7684\u73af\u5883\u4e2d\u6211\u66f4\u63a8\u8350\u5927\u5bb6\u4f7f\u7528",(0,r.jsx)(n.code,{children:"ServletContextAware"}),"\u6765\u83b7\u5f97\uff0c\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class JavaxWebSocketContainer implements ServletContextAware {\n\n    private volatile WebSocketContainer container;\n\n    public WebSocketContainer getContainer() {\n        if (container == null) {\n            synchronized (this) {\n                if (container == null) {\n                    container = ContainerProvider.getWebSocketContainer();\n                }\n            }\n        }\n        return container;\n    }\n\n    @Override\n    public void setServletContext(@NonNull ServletContext servletContext) {\n        if (container == null) {\n            container = (WebSocketContainer) servletContext\n                .getAttribute("javax.websocket.server.ServerContainer");\n        }\n    }\n}\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u6d88\u606f",children:"\u53d1\u6d88\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Session session = ...\n\n//\u53d1\u9001\u6587\u672c\u6d88\u606f\nsession.getAsyncRemote().sendText(String message);\n\n//\u53d1\u9001\u4e8c\u8fdb\u5236\u6d88\u606f\nsession.getAsyncRemote().sendBinary(ByteBuffer message);\n\n//\u53d1\u9001\u5bf9\u8c61\u6d88\u606f\uff0c\u4f1a\u5c1d\u8bd5\u4f7f\u7528Encoder\u7f16\u7801\nsession.getAsyncRemote().sendObject(Object message);\n\n//\u53d1\u9001ping\nsession.getAsyncRemote().sendPing(ByteBuffer buffer);\n\n//\u53d1\u9001pong\nsession.getAsyncRemote().sendPong(ByteBuffer buffer);\n\n"})}),"\n",(0,r.jsx)(n.h1,{id:"webmvc",children:"WebMVC"}),"\n",(0,r.jsx)(n.p,{children:"\u4f9d\u8d56\u80af\u5b9a\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-maven",children:" <dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-websocket</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u670d\u52a1\u7aef-1",children:"\u670d\u52a1\u7aef"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65-2",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.springframework.web.socket.WebSocketHandler;\nimport org.springframework.web.socket.WebSocketMessage;\nimport org.springframework.web.socket.WebSocketSession;\n\npublic class ServletWebSocketServerHandler implements WebSocketHandler {\n\n    @Override\n    public void afterConnectionEstablished(@NonNull WebSocketSession session) throws Exception {\n        //\u8fde\u63a5\u5efa\u7acb\n    }\n\n    @Override\n    public void handleMessage(@NonNull WebSocketSession session, @NonNull WebSocketMessage<?> message) throws Exception {\n        //\u63a5\u6536\u6d88\u606f\n    }\n\n    @Override\n    public void handleTransportError(@NonNull WebSocketSession session, @NonNull Throwable exception) throws Exception {\n        //\u5f02\u5e38\u5904\u7406\n    }\n\n    @Override\n    public void afterConnectionClosed(@NonNull WebSocketSession session, @NonNull CloseStatus closeStatus) throws Exception {\n        //\u8fde\u63a5\u5173\u95ed\n    }\n\n    @Override\n    public boolean supportsPartialMessages() {\n        //\u662f\u5426\u652f\u6301\u63a5\u6536\u4e0d\u5b8c\u6574\u7684\u6d88\u606f\n        return false;\n    }\n}\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u5b9e\u73b0\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u6765\u5904\u7406",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u8fde\u63a5\uff0c\u5173\u95ed\uff0c\u6d88\u606f\u548c\u5f02\u5e38"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65-2",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\n@EnableWebSocket\npublic class ServletWebSocketServerConfigurer implements WebSocketConfigurer {\n\n    @Override\n    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {\n        registry\n            //\u6dfb\u52a0\u5904\u7406\u5668\u5230\u5bf9\u5e94\u7684\u8def\u5f84\n            .addHandler(new ServletWebSocketServerHandler(), "/websocket")\n            .setAllowedOrigins("*");\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\u9700\u8981\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"@EnableWebSocket"}),"\u6765\u542f\u7528",(0,r.jsx)(n.code,{children:"WebSocket"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u5b9e\u73b0",(0,r.jsx)(n.code,{children:"WebSocketConfigurer"}),"\u6765\u6ce8\u518c",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u8def\u5f84\u4ee5\u53ca\u5bf9\u5e94\u7684",(0,r.jsx)(n.code,{children:"WebSocketHandler"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u63e1\u624b\u62e6\u622a",children:"\u63e1\u624b\u62e6\u622a"}),"\n",(0,r.jsxs)(n.p,{children:["\u63d0\u4f9b\u4e86",(0,r.jsx)(n.code,{children:"HandshakeInterceptor"}),"\u6765\u62e6\u622a\u63e1\u624b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\n@EnableWebSocket\npublic class ServletWebSocketServerConfigurer implements WebSocketConfigurer {\n\n    @Override\n    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {\n        registry\n            //\u6dfb\u52a0\u5904\u7406\u5668\u5230\u5bf9\u5e94\u7684\u8def\u5f84\n            .addHandler(new ServletWebSocketServerHandler(), "/websocket")\n            //\u6dfb\u52a0\u63e1\u624b\u62e6\u622a\u5668\n            .addInterceptors(new ServletWebSocketHandshakeInterceptor())\n            .setAllowedOrigins("*");\n    }\n    \n    public static class ServletWebSocketHandshakeInterceptor implements HandshakeInterceptor {\n\n        @Override\n        public boolean beforeHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Map<String, Object> attributes) throws Exception {\n            //\u63e1\u624b\u4e4b\u524d\n            //\u7ee7\u7eed\u63e1\u624b\u8fd4\u56detrue, \u4e2d\u65ad\u63e1\u624b\u8fd4\u56defalse\n            return false;\n        }\n\n        @Override\n        public void afterHandshake(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception exception) {\n            //\u63e1\u624b\u4e4b\u540e\n        }\n    }\n}\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6-2",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5728\u96c6\u6210\u7684\u65f6\u5019\u53d1\u73b0\u8fd9\u79cd\u65b9\u5f0f\u6ca1\u529e\u6cd5\u52a8\u6001\u5339\u914d\u8def\u5f84\uff0c\u5b83\u7684\u8def\u5f84\u5c31\u662f\u56fa\u5b9a\u7684\uff0c\u6ca1\u529e\u6cd5\u4f7f\u7528\u5982",(0,r.jsx)(n.code,{children:"/websocket/**"}),"\u8fd9\u6837\u7684\u901a\u914d\u7b26"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u5728\u7814\u7a76\u4e86\u4e00\u4e0b\u4e4b\u540e\u53d1\u73b0\u53ef\u4ee5\u5728",(0,r.jsx)(n.code,{children:"UrlPathHelper"}),"\u4e0a\u505a\u70b9\u6587\u7ae0"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Configuration\n@EnableWebSocket\npublic class ServletWebSocketServerConfigurer implements WebSocketConfigurer {\n\n    @Override\n    public void registerWebSocketHandlers(@NonNull WebSocketHandlerRegistry registry) {\n        if (registry instanceof ServletWebSocketHandlerRegistry) {\n            //\u66ff\u6362UrlPathHelper\n            ((ServletWebSocketHandlerRegistry) registry)\n                .setUrlPathHelper(new PrefixUrlPathHelper("/websocket"));\n        }\n\n        registry\n            //\u6dfb\u52a0\u5904\u7406\u5668\u5230\u5bf9\u5e94\u7684\u8def\u5f84\n            .addHandler(new ServletWebSocketServerHandler(), "/websocket/**")\n            .setAllowedOrigins("*");\n    }\n    \n    public class PrefixUrlPathHelper extends UrlPathHelper {\n\n        private String prefix;\n\n        @Override\n        public @NonNull String resolveAndCacheLookupPath(@NonNull HttpServletRequest request) {\n            //\u83b7\u5f97\u539f\u672c\u7684Path\n            String path = super.resolveAndCacheLookupPath(request);\n            //\u5982\u679c\u662f\u6307\u5b9a\u524d\u7f00\u5c31\u8fd4\u56de\u5bf9\u5e94\u7684\u901a\u914d\u8def\u5f84\n            if (path.startsWith(prefix)) {\n                return prefix + "/**";\n            }\n            return path;\n        }\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u56e0\u4e3a\u5b83\u5185\u90e8\u5b9e\u9645\u4e0a\u5c31\u662f\u7528\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"Map<String, WebSocketHandler>"}),"\u6765\u5b58\u7684\uff0c\u6240\u4ee5\u6ca1\u6709\u529e\u6cd5\u7528\u901a\u914d\u7b26"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3b\u8981\u662f\u6709\u73b0\u6210\u7684",(0,r.jsx)(n.code,{children:"AntPathMatcher"}),"\u5b9e\u73b0\u901a\u914d\u5e94\u8be5\u4e0d\u9ebb\u70e6\u624d\u5bf9\u554a"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5ba2\u6237\u7aef-1",children:"\u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65-3",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class ServletWebSocketClientHandler implements WebSocketHandler {\n\n    @Override\n    public void afterConnectionEstablished(@NonNull WebSocketSession session) throws Exception {\n        //\u8fde\u63a5\u5efa\u7acb\n    }\n\n    @Override\n    public void handleMessage(@NonNull WebSocketSession session, @NonNull WebSocketMessage<?> message) throws Exception {\n        //\u63a5\u6536\u6d88\u606f\n    }\n\n    @Override\n    public void handleTransportError(@NonNull WebSocketSession session, @NonNull Throwable exception) throws Exception {\n        //\u5f02\u5e38\u5904\u7406\n    }\n\n    @Override\n    public void afterConnectionClosed(@NonNull WebSocketSession session, @NonNull CloseStatus closeStatus) throws Exception {\n        //\u8fde\u63a5\u5173\u95ed\n    }\n\n    @Override\n    public boolean supportsPartialMessages() {\n        //\u662f\u5426\u652f\u6301\u63a5\u6536\u4e0d\u5b8c\u6574\u7684\u6d88\u606f\n        return false;\n    }\n}\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u548c\u670d\u52a1\u7aef\u4e00\u6837\u6211\u4eec\u9700\u8981\u5148\u5b9e\u73b0\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u6765\u5904\u7406",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u8fde\u63a5\uff0c\u5173\u95ed\uff0c\u6d88\u606f\u548c\u5f02\u5e38"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65-3",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"WebSocketClient client = new StandardWebSocketClient();\nWebSocketHandler handler = new ServletWebSocketClientHandler();\nWebSocketConnectionManager manager = new WebSocketConnectionManager(client, handler, uri);\nmanager.start();\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\u6211\u4eec\u9700\u8981\u5148",(0,r.jsx)(n.code,{children:"new"}),"\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"StandardWebSocketClient"}),"\uff0c\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"WebSocketContainer"}),"\u53c2\u6570\uff0c\u83b7\u5f97\u8be5\u5bf9\u8c61\u7684\u65b9\u5f0f\u6211\u4e4b\u524d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7\u4e86\uff0c\u8fd9\u8fb9\u5c31\u5148\u7565\u8fc7"]}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e",(0,r.jsx)(n.code,{children:"new"}),"\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"WebSocketConnectionManager"}),"\u4f20\u5165",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\uff0c",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u8fd8\u6709\u8def\u5f84",(0,r.jsx)(n.code,{children:"uri"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u6700\u540e\u8c03\u7528\u4e00\u4e0b",(0,r.jsx)(n.code,{children:"WebSocketConnectionManager"}),"\u7684",(0,r.jsx)(n.code,{children:"start"}),"\u65b9\u6cd5\u5c31\u53ef\u4ee5\u5566"]}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6-3",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u91cc\u5982\u679c\u5927\u5bb6\u53bb\u770b",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\u7684\u5b9e\u73b0\u7c7b\u5c31\u4f1a\u53d1\u73b0\u6709",(0,r.jsx)(n.code,{children:"StandardWebSocketClient"}),"\u8fd8\u6709",(0,r.jsx)(n.code,{children:"JettyWebSocketClient"}),"\u7b49\u7b49\uff0c\u6240\u4ee5\u5927\u5bb6\u53ef\u4ee5\u6839\u636e\u81ea\u8eab\u9879\u76ee\u6240\u4f7f\u7528\u7684\u5bb9\u5668\u6765\u9009\u62e9\u4e0d\u540c\u7684",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\u5b9e\u73b0\u7c7b"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u91cc\u7ed9\u5927\u5bb6\u8d34\u4e00\u5c0f\u6bb5",(0,r.jsx)(n.code,{children:"Spring"}),"\u9002\u914d\u4e0d\u540c\u5bb9\u5668",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u4ee3\u7801"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public abstract class AbstractHandshakeHandler implements HandshakeHandler, Lifecycle {\n\n    private static final boolean tomcatWsPresent;\n\n    private static final boolean jettyWsPresent;\n\n    private static final boolean jetty10WsPresent;\n\n    private static final boolean undertowWsPresent;\n\n    private static final boolean glassfishWsPresent;\n\n    private static final boolean weblogicWsPresent;\n\n    private static final boolean websphereWsPresent;\n\n    static {\n        ClassLoader classLoader = AbstractHandshakeHandler.class.getClassLoader();\n        tomcatWsPresent = ClassUtils.isPresent(\n            "org.apache.tomcat.websocket.server.WsHttpUpgradeHandler", classLoader);\n        jetty10WsPresent = ClassUtils.isPresent(\n            "org.eclipse.jetty.websocket.server.JettyWebSocketServerContainer", classLoader);\n        jettyWsPresent = ClassUtils.isPresent(\n            "org.eclipse.jetty.websocket.server.WebSocketServerFactory", classLoader);\n        undertowWsPresent = ClassUtils.isPresent(\n            "io.undertow.websockets.jsr.ServerWebSocketContainer", classLoader);\n        glassfishWsPresent = ClassUtils.isPresent(\n            "org.glassfish.tyrus.servlet.TyrusHttpUpgradeHandler", classLoader);\n        weblogicWsPresent = ClassUtils.isPresent(\n            "weblogic.websocket.tyrus.TyrusServletWriter", classLoader);\n        websphereWsPresent = ClassUtils.isPresent(\n            "com.ibm.websphere.wsoc.WsWsocServerContainer", classLoader);\n    }\n}\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u6d88\u606f-1",children:"\u53d1\u6d88\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.springframework.web.socket.*;\n\nWebSocketSession session = ...\n\n//\u53d1\u9001\u6587\u672c\u6d88\u606f\nsession.sendMessage(new TextMessage(CharSequence message);\n\n//\u53d1\u9001\u4e8c\u8fdb\u5236\u6d88\u606f\nsession.sendMessage(new BinaryMessage(ByteBuffer message));\n\n//\u53d1\u9001ping\nsession.sendMessage(new PingMessage(ByteBuffer message));\n\n//\u53d1\u9001pong\nsession.sendMessage(new PongMessage(ByteBuffer message));\n\n"})}),"\n",(0,r.jsx)(n.h1,{id:"webflux",children:"WebFlux"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"WebFlux"}),"\u7684",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u4e0d\u9700\u8981\u989d\u5916\u7684\u4f9d\u8d56\u5305"]}),"\n",(0,r.jsx)(n.h2,{id:"\u670d\u52a1\u7aef-2",children:"\u670d\u52a1\u7aef"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65-4",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'\nimport org.springframework.web.reactive.socket.WebSocketHandler;\nimport org.springframework.web.reactive.socket.WebSocketSession;\n\npublic class ReactiveWebSocketServerHandler implements WebSocketHandler {\n\n    @NonNull\n    @Override\n    public Mono<Void> handle(WebSocketSession session) {\n        Mono<Void> send = session.send(Flux.create(sink -> {\n            //\u53ef\u4ee5\u6301\u6709sink\u5bf9\u8c61\u5728\u4efb\u610f\u65f6\u5019\u8c03\u7528next\u53d1\u9001\u6d88\u606f\n            sink.next(WebSocketMessage message);\n        })).doOnError(it -> {\n            //\u5f02\u5e38\u5904\u7406\n        });\n\n        Mono<Void> receive = session.receive()\n                .doOnNext(it -> {\n                    //\u63a5\u6536\u6d88\u606f\n                })\n                .doOnError(it -> {\n                    //\u5f02\u5e38\u5904\u7406\n                })\n                .then();\n\n        @SuppressWarnings("all")\n        Disposable disposable = session.closeStatus()\n                .doOnError(it -> {\n                    //\u5f02\u5e38\u5904\u7406\n                })\n                .subscribe(it -> {\n                    //\u8fde\u63a5\u5173\u95ed\n                });\n\n        return Mono.zip(send, receive).then();\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\u9700\u8981\u6ce8\u610f\u8fd9\u91cc\u7684",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u548c",(0,r.jsx)(n.code,{children:"WebSocketSession"}),"\u662f",(0,r.jsx)(n.code,{children:"reactive"}),"\u5305\u4e0b\u7684"]}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7",(0,r.jsx)(n.code,{children:"WebSocketSession#send"}),"\u65b9\u6cd5\u6765\u6301\u6709\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"FluxSink<WebSocketMessage>"}),"\u6765\u7528\u4e8e\u53d1\u9001\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7",(0,r.jsx)(n.code,{children:"WebSocketSession#receive"}),"\u6765\u8ba2\u9605\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.p,{children:["\u901a\u8fc7",(0,r.jsx)(n.code,{children:"WebSocketSession#closeStatus"}),"\u6765\u8ba2\u9605\u8fde\u63a5\u5173\u95ed\u4e8b\u4ef6"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65-4",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@Component\npublic class ReactiveWebSocketServerHandlerMapping extends SimpleUrlHandlerMapping {\n\n    public ReactiveWebSocketServerHandlerMapping() {\n        Map<String, WebSocketHandler> map = new HashMap<>();\n        map.put("/websocket/**", new ReactiveWebSocketServerHandler());\n        setUrlMap(map);\n        setOrder(100);\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u518c\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"HandlerMapping"}),"\u540c\u65f6\u914d\u7f6e\u8def\u5f84\u548c\u5bf9\u5e94\u7684",(0,r.jsx)(n.code,{children:"WebSocketHandler"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e09\u6b65",children:"\u7b2c\u4e09\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"@Configuration(proxyBeanMethods = false)\npublic class ReactiveWebSocketConfiguration {\n\n    @Bean\n    public WebSocketHandlerAdapter webSocketHandlerAdapter() {\n        return new WebSocketHandlerAdapter();\n    }\n}\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u5165",(0,r.jsx)(n.code,{children:"WebSocketHandlerAdapter"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6-4",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u81ea\u5b9a\u4e49\u7684",(0,r.jsx)(n.code,{children:"HandlerMapping"}),"\u9700\u8981\u8bbe\u7f6e",(0,r.jsx)(n.code,{children:"order"}),"\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u4e3a",(0,r.jsx)(n.code,{children:"Ordered.LOWEST_PRECEDENCE"}),"\uff0c\u4f1a\u5bfc\u81f4\u8fd9\u4e2a",(0,r.jsx)(n.code,{children:"HandlerMapping"}),"\u88ab\u653e\u5728\u6700\u540e\uff0c\u5f53\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0a\u6765\u65f6\u4f1a\u88ab\u5176\u4ed6\u7684",(0,r.jsx)(n.code,{children:"HandlerMapping"}),"\u4f18\u5148\u5339\u914d\u4e0a\u800c\u8fde\u63a5\u5931\u8d25"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5ba2\u6237\u7aef-2",children:"\u5ba2\u6237\u7aef"}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e00\u6b65-5",children:"\u7b2c\u4e00\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class ReactiveWebSocketClientHandler implements WebSocketHandler {\n\n    @NonNull\n    @Override\n    public Mono<Void> handle(WebSocketSession session) {\n        Mono<Void> send = session.send(Flux.create(sink -> {\n            //\u53ef\u4ee5\u6301\u6709sink\u5bf9\u8c61\u5728\u4efb\u610f\u65f6\u5019\u8c03\u7528next\u53d1\u9001\u6d88\u606f\n            sink.next(WebSocketMessage message);\n        })).doOnError(it -> {\n            //\u5904\u7406\u5f02\u5e38\n        });\n\n        Mono<Void> receive = session.receive()\n                .doOnNext(it -> {\n                    //\u63a5\u6536\u6d88\u606f\n                })\n                .doOnError(it -> {\n                    //\u5f02\u5e38\u5904\u7406\n                })\n                .then();\n\n        @SuppressWarnings("all")\n        Disposable disposable = session.closeStatus()\n                .doOnError(it -> {\n                    //\u5f02\u5e38\u5904\u7406\n                })\n                .subscribe(it -> {\n                    //\u8fde\u63a5\u5173\u95ed\n                });\n\n        return Mono.zip(send, receive).then();\n    }\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5ba2\u6237\u7aef",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u7684\u5199\u6cd5\u548c\u670d\u52a1\u7aef\u7684\u4e00\u6837"]}),"\n",(0,r.jsx)(n.h3,{id:"\u7b2c\u4e8c\u6b65-5",children:"\u7b2c\u4e8c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"import org.springframework.web.reactive.socket.client.WebSocketClient;\n\nWebSocketClient client = ReactorNettyWebSocketClient();\nWebSocketHandler handler = new ReactiveWebSocketClientHandler();\nclient.execute(uri, handler).subscribe();\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\u6211\u4eec\u9700\u8981\u5148",(0,r.jsx)(n.code,{children:"new"}),"\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"ReactorNettyWebSocketClient"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u8c03\u7528\u4e00\u4e0b",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\u7684",(0,r.jsx)(n.code,{children:"execute"}),"\u65b9\u6cd5\u4f20\u5165\u8def\u5f84",(0,r.jsx)(n.code,{children:"uri"}),"\u548c",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u5e76\u7ee7\u7eed\u8c03\u7528",(0,r.jsx)(n.code,{children:"subscribe"}),"\u65b9\u6cd5\u5c31\u884c\u5566"]}),"\n",(0,r.jsx)(n.h3,{id:"\u51b7\u77e5\u8bc6-5",children:"\u51b7\u77e5\u8bc6"}),"\n",(0,r.jsxs)(n.p,{children:["\u548c",(0,r.jsx)(n.code,{children:"WebMVC"}),"\u4e2d\u7684",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\u4e00\u6837\uff0c",(0,r.jsx)(n.code,{children:"Reactive"}),"\u5305\u4e2d\u7684",(0,r.jsx)(n.code,{children:"WebSocketClient"}),"\u4e5f\u6709\u5f88\u591a\u5b9e\u73b0\u7c7b\uff0c\u6bd4\u5982",(0,r.jsx)(n.code,{children:"ReactorNettyWebSocketClient"}),"\uff0c",(0,r.jsx)(n.code,{children:"JettyWebSocketClient"}),"\uff0c",(0,r.jsx)(n.code,{children:"UndertowWebSocketClient"}),"\uff0c",(0,r.jsx)(n.code,{children:"TomcatWebSocketClient"}),"\u7b49\u7b49\uff0c\u4e5f\u662f\u9700\u8981\u5927\u5bb6\u57fa\u4e8e\u81ea\u8eab\u9879\u76ee\u7684\u5bb9\u5668\u4f7f\u7528\u4e0d\u540c\u7684\u5b9e\u73b0\u7c7b"]}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u91cc\u4e5f\u7ed9\u5927\u5bb6\u8d34\u4e00\u5c0f\u6bb5",(0,r.jsx)(n.code,{children:"Reactive"}),"\u9002\u914d\u4e0d\u540c\u5bb9\u5668",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u7684\u4ee3\u7801"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'public class HandshakeWebSocketService implements WebSocketService, Lifecycle {\n\n    private static final boolean tomcatPresent;\n\n    private static final boolean jettyPresent;\n\n    private static final boolean jetty10Present;\n\n    private static final boolean undertowPresent;\n\n    private static final boolean reactorNettyPresent;\n\n    static {\n        ClassLoader loader = HandshakeWebSocketService.class.getClassLoader();\n        tomcatPresent = ClassUtils.isPresent("org.apache.tomcat.websocket.server.WsHttpUpgradeHandler", loader);\n        jettyPresent = ClassUtils.isPresent("org.eclipse.jetty.websocket.server.WebSocketServerFactory", loader);\n        jetty10Present = ClassUtils.isPresent("org.eclipse.jetty.websocket.server.JettyWebSocketServerContainer", loader);\n        undertowPresent = ClassUtils.isPresent("io.undertow.websockets.WebSocketProtocolHandshakeHandler", loader);\n        reactorNettyPresent = ClassUtils.isPresent("reactor.netty.http.server.HttpServerResponse", loader);\n    }\n}\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u6d88\u606f-2",children:"\u53d1\u6d88\u606f"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5728",(0,r.jsx)(n.code,{children:"WebSocketHandler"}),"\u4e2d\u83b7\u5f97\u7684",(0,r.jsx)(n.code,{children:"FluxSink<WebSocketMessage>"}),"\u6765\u53d1\u9001\u6d88\u606f"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.springframework.web.reactive.socket.CloseStatus;\nimport org.springframework.web.reactive.socket.WebSocketMessage;\nimport org.springframework.web.reactive.socket.WebSocketSession;\n\npublic class ReactiveWebSocket {\n\n    private final WebSocketSession session;\n\n    private final FluxSink<WebSocketMessage> sender;\n\n    public ReactiveWebSocket(WebSocketSession session, FluxSink<WebSocketMessage> sender) {\n        this.session = session;\n        this.sender = sender;\n    }\n\n    public String getId() {\n        return session.getId();\n    }\n\n    public URI getUri() {\n        return session.getHandshakeInfo().getUri();\n    }\n\n    public void send(Object message) {\n        if (message instanceof WebSocketMessage) {\n            sender.next((WebSocketMessage) message);\n        } else if (message instanceof String) {\n            //\u53d1\u9001\u6587\u672c\u6d88\u606f\n            sender.next(session.textMessage((String) message));\n        } else if (message instanceof DataBuffer) {\n            //\u53d1\u9001\u4e8c\u8fdb\u5236\u6d88\u606f\n            sender.next(session.binaryMessage(factory -> (DataBuffer) message));\n        } else if (message instanceof ByteBuffer) {\n            ////\u53d1\u9001\u4e8c\u8fdb\u5236\u6d88\u606f\n            sender.next(session.binaryMessage(factory -> factory.wrap((ByteBuffer) message)));\n        } else if (message instanceof byte[]) {\n            ////\u53d1\u9001\u4e8c\u8fdb\u5236\u6d88\u606f\n            sender.next(session.binaryMessage(factory -> factory.wrap((byte[]) message)));\n        } else {\n            throw new IllegalArgumentException("Message type not match");\n        }\n    }\n\n    public void ping() {\n        //\u53d1\u9001ping\n        sender.next(session.pingMessage(factory -> factory.wrap(ByteBuffer.allocate(0))));\n    }\n\n    public void pong() {\n        //\u53d1\u9001pong\n        sender.next(session.pongMessage(factory -> factory.wrap(ByteBuffer.allocate(0))));\n    }\n\n    public void close(CloseStatus reason) {\n        sender.complete();\n        session.close(reason).subscribe();\n    }\n}\n\n\n'})}),"\n",(0,r.jsx)(n.h1,{id:"java-websocket",children:"Java-WebSocket"}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u662f\u4e00\u4e2a\u7eaf",(0,r.jsx)(n.code,{children:"java"}),"\u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u4e13\u95e8\u7528\u4e8e\u5b9e\u73b0",(0,r.jsx)(n.code,{children:"WebSocket"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTooTallNate%2FJava-WebSocket",title:"https://github.com/TooTallNate/Java-WebSocket",children:"Github"}),"\u4e0a\u5df2\u7ecf\u6709\u5f88\u8be6\u7ec6\u7684\u4f7f\u7528\u6559\u7a0b\u4e86\uff0c\u73b0\u5728\u6709",(0,r.jsx)(n.code,{children:"9k+"}),"\u7684",(0,r.jsx)(n.code,{children:"Star"})]}),"\n",(0,r.jsx)(n.h1,{id:"socketio",children:"SocketIO"}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5\u5e93\u4f7f\u7528\u7684\u534f\u8bae\u662f\u7ecf\u8fc7\u81ea\u5df1\u5c01\u88c5\u7684\uff0c\u652f\u6301\u5f88\u591a\u7684\u8bed\u8a00\uff0c\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u5b83\u63d0\u4f9b\u7684",(0,r.jsx)(n.code,{children:"Server"}),"\u548c",(0,r.jsx)(n.code,{children:"Client"}),"\u6765\u8fde\u63a5\uff0c\u5982",(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio%2Fsocket.io-server-java",title:"https://github.com/socketio/socket.io-server-java",children:"socket.io-server-java"}),"\u548c",(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio%2Fsocket.io-client-java",title:"https://github.com/socketio/socket.io-client-java",children:"socket.io-client-java"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u4e2a\u5e93\u6211\u4e86\u89e3\u4e0b\u6765\u4e3b\u8981\u7528\u4e8e\u5b9e\u65f6\u804a\u5929\u7b49\u573a\u666f\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u662f\u666e\u901a\u7684",(0,r.jsx)(n.code,{children:"WebSocket"}),"\u529f\u80fd\u5c31\u6709\u70b9\u5927\u6750\u5c0f\u7528\u4e86"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsocketio",title:"https://github.com/socketio",children:"Github"}),"\u4e0a\u4e5f\u6709\u975e\u5e38\u8be6\u7ec6\u7684\u4f7f\u7528\u6587\u6863\uff0c\u5927\u5bb6\u5982\u679c\u6709\u5174\u8da3\u53ef\u4ee5\u7814\u7a76\u4e00\u4e0b"]}),"\n",(0,r.jsx)(n.h1,{id:"netty",children:"Netty"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e2a\u5927\u5bb6\u5e94\u8be5\u90fd\u6bd4\u8f83\u719f\u6089\u4e86\uff0c\u5c31\u7b97\u6ca1\u7528\u8fc7\u80af\u5b9a\u4e5f\u542c\u8fc7"}),"\n",(0,r.jsxs)(n.p,{children:["\u7f51\u4e0a\u7684\u6587\u6863\u548c\u793a\u4f8b\u4e5f\u975e\u5e38\u591a\uff0c\u6211\u8fd9\u91cc\u5c31\u4e0d\u4ecb\u7ecd\u6709\u7684\u6ca1\u7684\u4e86\uff0c",(0,r.jsx)(n.a,{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnetty%2Fnetty",title:"https://github.com/netty/netty",children:"Github\u4f20\u9001\u95e8"})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);